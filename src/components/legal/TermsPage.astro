---
import Base from '../../layouts/Base.astro';
import { DEFAULT_LANG, getDict, type ActiveLang } from '../../i18n';
import { getCanonicalUrl } from '../../utils/seo';

interface Props {
    lang?: ActiveLang;
}

const { lang = DEFAULT_LANG } = Astro.props as Props;
const dict = getDict(lang);
const terms = dict.terms;

if (!terms) {
    throw new Error('Missing terms translations');
}

const privacyPath = lang === DEFAULT_LANG ? '/privacy' : `/${lang}/privacy`;
const applyPlaceholders = (value: string) =>
    value.replaceAll('{{privacyLink}}', privacyPath);

const sections = terms.sections.map((section) => ({
    ...section,
    body: section.body.map((paragraph) => applyPlaceholders(paragraph)),
}));

const lastUpdated = new Date().toLocaleDateString(lang);
const title = `${terms.metaTitle} â€” Auris Internacional`;
const description = terms.metaDescription ?? terms.intro;
const url = getCanonicalUrl(lang, '/terms');
---
<Base title={title} description={description} url={url} lang={lang}>
    <section class="mx-auto max-w-3xl space-y-8 px-4 py-16 text-white/90">
        <header class="space-y-4">
        <h1 class="text-3xl font-semibold text-white sm:text-4xl">{terms.heading}</h1>
        <p class="text-base" set:html={applyPlaceholders(terms.intro)}></p>
        </header>

        {sections.map((section) => (
        <section class="space-y-3">
            <h2 class="text-2xl font-semibold text-white">{section.title}</h2>
            {section.body.map((paragraph) => (
            <p class="text-base" set:html={paragraph}></p>
            ))}
        </section>
        ))}

        <p class="text-sm text-white/70">{terms.lastUpdatedLabel}: {lastUpdated}</p>
    </section>
</Base>